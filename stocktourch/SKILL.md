---
name: stock-research

description: |
  增强型股票研究技能，提供实时行情、技术分析、财务分析、行业分类和大盘分析功能。
  从baostock获取A股实时数据，计算MA、RSI、MACD、KDJ等技术指标，
  提供多维度量化评分模型和投资建议。支持基本面分析、财务数据评估、
  行业分类查询和指数成分股分析。通过爬取主流财经媒体获取市场分析和投资建议，
  提供综合性的投资决策支持。适用于个股分析、市场趋势跟踪、财务评估、
  大盘走势分析和投资策略制定等场景。支持多种输出格式和缓存机制，
  确保数据的实时性和分析的准确性。

allowed-tools:
  - Read
  - Write
  - Edit
  - AskUserQuestion

metadata:
  trigger: 股票分析、技术指标、财务评估、行业分类、投资建议、大盘分析
  source: 基于baostock数据接口和财经网络爬虫技术，整合量化分析模型
---

# Stock Research

A股智能分析系统 - 支持实时行情、技术分析、财务分析、行业分类和大盘分析。

## 目标

从baostock实时获取A股数据，支持：
- 实时行情（股价、涨跌幅、成交量等）
- 技术分析（MA、RSI、MACD、KDJ等指标）
- 财务分析（资产负债表、现金流量表、利润表）
- 行业分类（证监会行业分类）
- 量化评分（多维度评分模型）
- 操作建议（买入/卖出/持有建议）
- **大盘分析**（获取主流财经媒体对大盘走势的分析和投资建议）
- **综合分析**（结合技术数据和网络信息的深度分析）

## 执行流程

### 1. 识别用户意图

根据用户输入确定：
- **股票代码**: 个股分析 / 指数成分股
- **分析类型**: 技术分析 / 基本面分析 / 财务分析 / 综合分析
- **输出需求**: 简要报告 / 详细分析 / 数据表格
- **大盘分析**: 宏观走势 / 市场情绪 / 投资策略

### 2. 构建命令

**基础命令模板**:
``bash
python3 run_skill.py <股票代码> [选项] [参数]
```

**常用场景映射**:

| 用户需求 | 股票代码 | 关键参数 |
|---------|--------|----------|
| 个股综合分析 | `000001` | `analysis` |
| 技术分析 | `000001` | `technical` |
| 基本面分析 | `000001` | `fundamental` |
| 行业分类 | `000001` | `industry` |
| 财务分析 | `000001` | `finance` |
| 指数成分股 | `hs300` | 无 |
| **大盘分析** | **market** | **`report`** |
| **综合分析** | **000001** | **`comprehensive`** |

### 3. 执行命令

``bash
# 进入技能目录
cd .qcoder/skills/股票研究

# 执行股票分析
python3 run_skill.py [参数]
```

### 4. 处理输出

- 对于大盘分析，AI直接使用内置搜索工具获取实时市场数据
- AI负责理解数据并按照用户需求进行格式化输出
- AI根据上下文提供适当的分析和建议
- **对于综合分析**，系统将自动执行以下步骤：
  1. 使用现有Python脚本获取技术数据（基本信息、技术指标、基本面数据、行业分类等）
  2. 调用AI内置网络搜索功能，搜索与该股票或相关板块相关的最新网络信息
  3. 将技术数据和网络信息进行综合分析，生成完整的投资分析报告

## 支持的股票代码格式

- **6位数字代码**: `000001`, `600036`
- **带交易所前缀**: `sz.000001`, `sh.600036`
- **指数代码**: `hs300`, `sz50`, `zz500`
- **大盘分析**: `market`, `index`, `overview`

## 参数说明

| 参数 | 简写 | 说明 | 默认值 |
|------|------|------|--------|
| `<股票代码>` | - | 股票代码（如 000001, 600036） | - |
| `<分析类型>` | - | `info`, `quote`, `analysis`, `technical`, `fundamental`, `industry`, `finance`, `report` | `analysis` |
| `--format` | `-f` | 输出格式（`text`/`json`/`csv`） | `text` |
| `--no-cache` | - | 禁用智能缓存 | 启用 |
| `--cache-ttl` | - | 缓存TTL（小时） | `24` |
| `--verbose` | `-v` | 详细日志输出 | 关闭 |

## 示例

### 场景 1: 个股综合分析

**用户输入**: "分析平安银行 000001"

**执行命令**:
```bash
python3 run_skill.py 000001 analysis
```

**AI输出**: 包含行情、技术分析、基本面分析、评分和操作建议的综合报告。

---

### 场景 2: 技术分析

**用户输入**: "获取平安银行技术指标"

**执行命令**:
```bash
python3 run_skill.py 000001 technical
```

**AI输出**: MA、RSI、MACD、KDJ等技术指标分析。

---

### 场景 3: 行业分类分析

**用户输入**: "查看平安银行所属行业"

**执行命令**:
```bash
python3 run_skill.py 000001 industry
```

**AI输出**: 证监会行业分类信息。

---

### 场景 4: 指数成分股查询

**用户输入**: "获取沪深300成分股"

**执行命令**:
```bash
python3 run_skill.py hs300
```

**AI输出**: 沪深300成分股列表。

---

### 场景 5: 财务分析

**用户输入**: "分析招商银行财务状况"

**执行命令**:
```bash
python3 run_skill.py 600036 finance
```

**AI输出**: 财务数据分析（资产负债表、现金流量表、利润表等）。

---

### 场景 6: JSON格式输出

**用户输入**: "以JSON格式输出平安银行数据"

**执行命令**:
```bash
python3 run_skill.py 000001 --format json
```

**AI输出**: 解析JSON数据并按用户需求格式化展示。

---

### 场景 7: 大盘情况报告

**用户输入**: "获取今日大盘情况报告"

**执行命令**:
```bash
python3 run_skill.py market report
```

**AI输出**: 整合主流财经媒体对大盘走势的分析和投资建议。

---

### 场景 8: 综合分析

**用户输入**: "对平安银行进行综合分析"

**执行命令**:
```bash
python3 run_skill.py 000001 comprehensive
```

**AI输出**: 结合技术数据和网络信息的深度分析报告，包含技术面、基本面、新闻面的综合评估和投资建议。

---

## 分析类型

### 1. 基本资料 (info)
- 获取股票基本信息：代码、名称、价格等

### 2. 实时行情 (quote)  
- 获取实时股价、涨跌幅、成交量、成交额等

### 3. 综合分析 (analysis)
- 综合技术面、基本面、情绪面的全面分析

### 4. 技术分析 (technical)
- MA、RSI、MACD、KDJ等技术指标

### 5. 基本面分析 (fundamental)
- PE、PB、换手率等基本面指标

### 6. 行业分类 (industry)
- 证监会行业分类信息

### 7. 财务分析 (finance)
- 资产负债表、现金流量表、利润表分析

### 8. 综合分析 (comprehensive)
- **结合技术数据和网络信息的深度分析**

  - **网络信息搜索**: 公司最新公告和重大事件、行业动态和政策影响、市场分析师观点和评级、相关新闻和媒体报道、机构调研和持仓变化
  - **技术数据获取**: 基本信息（代码、名称、价格等）、技术指标（MA、RSI、MACD、KDJ等）、基本面数据（PE、PB、换手率等）、行业分类信息、财务分析等
  - **综合分析**: 将技术数据和网络信息进行综合分析，生成完整的投资分析报告
  - **输出**: 包含技术面分析、基本面分析、市场情绪和新闻面分析、综合投资建议和风险提示的完整报告

### 9. 大盘分析 (report)
- **获取主流财经媒体对大盘走势的分析**
  - **数据源**: 新浪财经、东方财富、同花顺、雪球、华尔街见闻等
  - **内容**: 大盘走势分析、市场情绪、投资策略、风险提示
  - **输出**: 结构化的大盘分析报告，包含宏观趋势、热点板块、投资建议等

## 综合分析功能详解

### 目标
对于个股的综合分析，系统将自动化执行以下步骤：
1. 首先使用现有的Python脚本获取股票的技术数据，包括基本信息（代码、名称、价格等）、技术指标（MA、RSI、MACD、KDJ等）、基本面数据（PE、PB、换手率等）、行业分类信息等
2. 然后调用AI的内置网络搜索功能，搜索与该股票或相关板块相关的最新网络信息，包括公司最新公告和重大事件、行业动态和政策影响、市场分析师观点和评级、相关新闻和媒体报道、机构调研和持仓变化
3. 最后将技术数据和网络信息进行综合分析，生成一份完整的投资分析报告，报告应包含技术面分析结果、基本面分析结果、市场情绪和新闻面分析、综合投资建议（买入/卖出/持有）和风险提示

### 技术实现
- **技术数据获取**: 通过现有的baostock数据接口获取实时行情、技术指标、基本面数据和行业分类信息
- **网络信息搜索**: 当用户请求comprehensive选项时，AI将自动调用内置搜索功能获取与股票相关的最新网络信息
- **综合分析**: 将技术数据和网络信息进行融合分析，生成包含多维度信息的投资建议

### 数据内容
- **技术面分析**: MA、RSI、MACD、KDJ等技术指标分析
- **基本面分析**: PE、PB、换手率等基本面指标分析
- **新闻面分析**: 公司公告、行业动态、分析师观点等信息分析
- **综合投资建议**: 基于技术面、基本面和新闻面的综合判断
- **风险提示**: 基于多维度信息的风险评估

## 大盘分析功能详解

### 目标
AI直接使用内置搜索工具获取最新市场行情，不再依赖脚本数据源，生成专业的市场分析报告。

### 技术实现
- **时间判断**: 根据当前时间自动判断市场状态
  - **开盘前**(上午9:30之前): 搜索并使用前一交易日的收盘数据生成报告
  - **交易中**(上午9:30至下午3:00): 获取并报告当前实时市场数据
  - **收盘后**(下午3:00之后): 获取并报告当日最终收盘数据
- **信息整合**: 综合用户输入、当前时间和上下文信息
- **网络搜索**: 
  - **开盘前**: 搜索"{前一交易日日期} A股收盘 上证指数 深证成指 创业板指 沪深300"等相关信息
  - **交易中**: 搜索"今日 A股实时 上证指数 深证成指 创业板指 沪深300"等相关信息
  - **收盘后**: 搜索"{当前日期} A股收盘 上证指数 深证成指 创业板指 沪深300"等相关信息
- **数据核实**: 对所有关键统计数据进行全面核实，确保数据准确性
- **AI分析**: 基于搜索结果和当前市场状态直接生成分析报告
- **格式化输出**: 生成适合公众号发布的精美Markdown格式报告

### 数据内容
- **当日大盘走势**: 主要指数表现情况
- **市场热点板块**: 领涨领跌板块分析
- **资金流向**: 北向资金、主力资金动向
- **市场情绪评估**: 投资者情绪和市场氛围分析
- **后市展望**: 技术面分析和操作建议

### 输出格式
AI生成结构化的Markdown报告，包含：
- 适当的标题层级
- 清晰的列表和表格
- 专业的引用和注释
- 适合公众号发布的视觉效果

## 综合分析输出格式

### 报告结构
完整的综合分析报告应包含以下结构：
- **股票基本信息**: 股票代码、名称、当前价格、涨跌幅等
- **技术面分析**: MA、RSI、MACD、KDJ等技术指标详细分析
- **基本面分析**: PE、PB、换手率等基本面指标分析
- **新闻面分析**: 公司公告、行业动态、分析师观点等内容摘要
- **市场情绪评估**: 基于新闻和市场信息的情绪分析
- **综合投资建议**: 结合技术面、基本面和新闻面的买入/卖出/持有建议
- **风险提示**: 基于多维度分析的风险评估
- **数据来源说明**: 技术数据来源和网络信息来源标注

### 报告生成流程
1. **数据收集**: 直接通过AI内置搜索工具获取当日市场数据
2. **数据核实**: 对所有关键数据（包括指数、涨跌幅、成交量等）进行全面核实
3. **交叉验证**: 对搜索结果进行多源验证，确保准确性
4. **报告编写**: 将核实后的数据整合进报告
5. **质量检查**: 确保报告中所有数据准确无误

### 报告结构模板
完整的市场分析报告应包含以下结构：
- **主要指数表现**: 上证指数、深证成指、创业板指、科创板指的详细分析
- **市场概况**: 成交量分析、涨跌分布、涨停/跌停股票统计
- **板块表现分析**: 强势板块和弱势板块的详细分析
- **资金流向分析**: 北向资金、主力资金、两融资金流向
- **市场统计分析**: 关键数据核实与统计指标
- **市场情绪评估**: 投资者情绪与风险偏好分析
- **重要事件与消息面**: 政策动态、海外市场影响、公司动态
- **后市展望与操作建议**: 技术面分析、基本面评估、操作策略建议


## 评分模型

### 权重分配
- **基本面评分**: 40%
- **技术面评分**: 35% 
- **情绪面评分**: 25%

### 风险等级
- **9-10分**: 低风险
- **7-8分**: 中低风险
- **5-6分**: 中高风险
- **3-4分**: 高风险
- **1-2分**: 极高风险

## 操作建议

- **买入**: 技术面强势+基本面良好+市场情绪积极时建议买入
- **卖出**: 技术面破位+基本面恶化+市场情绪转差时建议卖出
- **持有**: 震荡行情或不确定性强时建议持有观望

## 依赖安装

```bash
# 基础依赖（必需）
 -m pip install -i https://mirrors.aliyun.com/pypi/simple --break-system-packages baostock pandas numpy

# 完整依赖（推荐）
python3 -m pip install -i https://mirrors.aliyun.com/pypi/simple --break-system-packages -r requirements.txt 

# 包含:
# - baostock >= 0.8.90 (A股数据源)
# - pandas >= 1.5.0 (数据处理)
# - numpy >= 1.21.0 (数值计算)
# - matplotlib >= 3.5.0 (可视化)
# - seaborn >= 0.11.0 (统计图表)
# - aiohttp >= 3.9.0 (异步爬虫)
# - beautifulsoup4 >= 4.12.0 (HTML解析)
```

## 注意事项

1. **首次运行**: 需要先安装依赖 `pip install -r requirements.txt`
2. **数据源**: 个股分析使用baostock作为数据源；大盘分析和综合分析AI直接使用内置搜索工具获取实时数据
3. **缓存机制**: 默认启用24小时缓存，使用 `--no-cache` 禁用
4. **股票代码**: 支持6位数字代码或带交易所前缀格式
5. **输出格式**: 支持text、json、csv三种格式
6. **AI处理**: python3脚本提供个股数据，AI负责理解并按需格式化输出；大盘分析和综合分析直接由AI使用搜索工具完成
7. **综合分析功能**: 使用comprehensive选项时，AI将自动执行技术数据获取、网络信息搜索和综合分析的完整流程