---
name: 股票研究

description: |
  增强型股票研究技能，提供实时行情、技术分析、财务分析、行业分类和大盘分析功能。
  从 baostock 和 AKShare 获取 A 股实时数据，计算 MA、RSI、MACD、KDJ 等技术指标，
  支持日线、周线、月线多周期联合判断。提供多维度量化评分模型和投资建议。
  特色功能包括同业横向对比、资金流专项分析（主力/北向/南向）、财务深度分析、
  行业估值比较等。通过爬取主流财经媒体获取市场分析和投资建议，
  提供综合性的投资决策支持。适用于个股分析、市场趋势跟踪、财务评估、
  大盘走势分析和投资策略制定等场景。支持多种输出格式和缓存机制，
  确保数据的实时性和分析的准确性。

allowed-tools:
  - Read
  - Write
  - Edit
  - AskUserQuestion

metadata:
  trigger: 股票分析、技术指标、财务评估、行业分类、投资建议、大盘分析
  source: 基于baostock数据接口和财经网络爬虫技术，整合量化分析模型
---

# Stock Research

A股智能分析系统 - 支持实时行情、技术分析、财务分析、行业分类和大盘分析。

## 目标

从 baostock 和 AKShare 实时获取 A 股数据，支持：
- 实时行情（股价、涨跌幅、成交量、成交额等）
- 技术分析（MA、RSI、MACD、KDJ 等指标）
  - **多周期联合判断**：日线、周线、月线三个级别综合分析
- 财务分析（资产负债表、现金流量表、利润表）
  - 通过 `core/financial_analyzer.py` 获取 AKShare 财务数据
  - 使用 `get_comprehensive_financial_report()` 方法获取三大报表数据
  - **按照** `report/读财报.md` 方法论深度分析财报
- **同业横向对比**
  - 同行业多公司财务指标对比
  - 估值水平横向比较（PE、PB、PEG 等）
  - 成长性、盈利能力、营运能力对比
- **资金流专项分析**
  - 主力资金流向（大单/超大单净流入）
  - 北向资金持仓变化
  - 南向资金动向（港股通）
- 行业分类（证监会行业分类）
- 量化评分（多维度评分模型）
- 操作建议（买入/卖出/持有建议）
- **大盘分析**（获取主流财经媒体对大盘走势的分析和投资建议）
- **综合分析**（结合技术数据和网络信息的深度分析）

## 执行流程

### 1. 识别用户意图

根据用户输入确定：
- **股票代码**: 个股分析 / 指数成分股
- **分析类型**: 技术分析 / 基本面分析 / 财务分析 / 同业对比 / 资金流分析 / 综合分析
- **输出需求**: 简要报告 / 详细分析 / 数据表格 / 对比图表
- **周期级别**: 日线 / 周线 / 月线 / 多周期联合
- **大盘分析**: 宏观走势 / 市场情绪 / 投资策略

### 2. AI 调度执行（核心）

**重要说明**：
- `run_skill.py` 仅用于演示各个功能模块的使用方法
- **AI 负责完整的流程调度**，根据 SKILL.md 文档自动调用各个模块
- AI 需要主动协调：数据获取 → 财报下载 → 财报解析 → 网络搜索 → 综合分析 → 生成报告

**AI 调度职责**：
1. 根据用户需求选择合适的 Python 脚本获取基础数据
2. **必须主动调用** `core/financial_analyzer.py` 获取最新财务数据（基于 AKShare）
3. **必须使用** `get_comprehensive_financial_report()` 方法获取三大报表数据
4. **必须按照** `report/读财报.md` 方法论深度分析财报
5. **必须调用** `search_web` 工具搜索最新网络信息
6. 综合所有信息进行融合分析
7. 生成 Markdown 格式分析报告并保存

**数据输出要求**：
- Python 脚本必须将获取到的**所有原始数据格式化输出**给 AI
- 财务数据输出必须包含完整的**关键指标字典**（key_metrics），包括：
  - 资产负债表指标（总资产、总负债、货币资金、应收账款、存货、商誉等）
  - 利润表指标（营业收入、毛利润、净利润、扣非净利润、各项费用等）
  - 现金流量表指标（经营/投资/筹资现金流净额、销售商品收到的现金等）
  - 财务比率指标（ROE、毛利率、净利率、周转率、增长率等）
  - 风险评估指标（五大黄金标准、快速排雷清单、现金流肖像等）
- AI 接收数据后，必须进行**多维度交叉验证**和**深度分析**，而非简单罗列数据

### 3. 构建命令与示例

**基础命令模板**:
``bash
python3 run_skill.py <股票代码> [选项] [参数]
```

**常用场景参考**:

| 用户需求 | 股票代码 | 关键参数 |
|---------|--------|----------|
| 个股综合分析 | `000001` | 无 |
| 技术分析（多周期） | `000001` | `technical --period daily_weekly_monthly` |
| 基本面分析 | `000001` | `fundamental` |
| 同业横向对比 | `000001` | `compare_peers` |
| 资金流分析 | `000001` | `capital_flow` |
| 行业分类 | `000001` | `industry` |
| 财务分析 | `000001` | `finance` |
| 指数成分股 | `hs300` | 无 |
| 大盘分析 | **market** | **`report`** |
| 财务分析 | `000001` | **`finance`** |

### 4. 常用场景与命令示例

**常用命令**:
```bash
# 个股综合分析（技术面 + 基本面 + 新闻面）
python3 run_skill.py 000001 comprehensive

# 技术分析
python3 run_skill.py 000001 technical

# 基本面分析
python3 run_skill.py 000001 fundamental

# 行业分类
python3 run_skill.py 000001 industry

# 财务分析
python3 run_skill.py 600036 finance
```


### 4. 项目结构

```
stocktourch/
├── run_skill.py          # 入口脚本
├── SKILL.md              # 技能定义
├── requirements.txt      # 依赖
│
├── core/                 # 核心分析器
│   ├── stock_analyzer.py      # 股票分析器
│   ├── financial_analyzer.py  # 财务分析器
│   ├── market_analyzer.py     # 大盘分析器
│   └── ai_market_analyzer.py  # AI市场分析器
│
├── utils/                # 工具模块
│   ├── config.py             # 配置
│   ├── utils.py              # 工具函数
│   ├── cache_manager.py      # 缓存管理
│   └── output_formatter.py   # 输出格式化
│
├── report/               # 财报模块
│   ├── 读财报.md            # 财报分析方法论
│   └── report_reader.py     # PDF 读取器（备用）
│
├── web/                 # 网络模块
│   └── web_crawler.py       # 网页爬虫
│
├── executor/             # 执行器
│   └── skill_executor.py   # 技能执行器
│
└── assets/              # 资源文件
    ├── stocks.json               # 股票数据库
    └── financial_analyst_prompt.txt
```


### 5. AI 处理输出与流程

**AI 核心职责**：
- `run_skill.py` 仅作为功能演示工具，展示各个模块的独立使用方法
- **AI 是真正的调度中枢**，负责根据用户需求自动编排完整分析流程

**对于大盘分析**：
1. AI 直接使用内置搜索工具获取实时市场数据
2. AI 负责理解数据并按照用户需求进行格式化输出
3. AI 根据上下文提供适当的分析和建议
4. **时效性要求**:
   - **AI 必须先获取当前日期**,然后在搜索查询中注明具体日期
   - **搜索查询示例**: "[当前日期] A 股收盘 上证指数 深证成指 创业板指"(如"2026 年 2 月 19 日 A 股收盘")
   - **报告中需注明交易日期**,例如:"[当前日期]，上证指数收盘 XXXX 点"
   - **如非交易日**,应说明"截至最近交易日 ([最近交易日日期]) 数据"

**对于综合分析 (个股)**：
AI 必须主动执行以下完整流程：

**第一步：技术数据获取**
1. 使用 Python 脚本获取股票技术数据：
   - 基本信息（代码、名称、价格、涨跌幅等）
   - 技术指标（MA、RSI、MACD、KDJ 等）
   - 基本面数据（PE、PB、换手率等）
   - 行业分类信息等
   - **注意**:所有技术数据均为最新交易日数据，报告中需注明"截至 [最新交易日] 收盘"或类似时间说明

**第二步：财务数据获取与格式化输出**
2. **必须调用** `core/financial_analyzer.py` 的 `get_comprehensive_financial_report()` 方法
   - 直接从 AKShare 获取三大报表的完整绝对值数据
   - 从 baostock 获取财务比率和增长率数据
   - **关键：脚本必须将所有数据格式化输出给 AI**,包括:
     * 完整的 key_metrics 字典（包含所有提取的财务指标）
     * 资产负债表详细数据（总资产、货币资金、应收账款、存货、固定资产、商誉、有息负债等）
     * 利润表详细数据（营业收入、营业成本、毛利润、净利润、扣非净利润、三费、研发费用等）
     * 现金流量表详细数据（三大活动现金流净额、销售商品收到的现金等）
     * 运营能力指标（应收账款周转率、存货周转率、总资产周转率等）
     * 成长能力指标（营收增长率、净利润增长率、净资产增长率等）
     * 杜邦分析指标（ROE 拆解、税收负担、利息负担等）
     * 风险评估结果（五大黄金标准、快速排雷清单、现金流肖像等）
   - **注意**:财报数据具有滞后性，报告中需明确说明"基于 2025 年第三季度报告"或"截至 2025 年 9 月 30 日数据"

**第三步：财报深度分析**
3. **必须按照** `report/读财报.md` 方法论进行系统化财务分析：
   - 审计意见检查（一票否决）
   - 资产负债表分析（速读四步法、三类资产质量、负债结构）
   - 利润表分析（核心指标提取、利润质量检验、同比环比）
   - 现金流量表分析（现金流肖像、五大黄金标准、净利润含金量）
   - 造假风险识别（红旗清单、存贷双高、异常科目排查）
   - 杜邦分析（ROE 拆解、盈利模式判断）
   - 估值与击球区计算（PE 估值法、安全边际、买入区间）
   - **注意**:所有分析结论需注明基于哪一期财报数据

**第四步：网络信息搜索**
4. **必须调用** `search_web` 工具搜索最新网络信息，**时效性要求**:
   - **AI 必须先获取当前日期**,然后基于当前日期生成搜索查询
   - **搜索查询示例**(假设当前日期为 2026 年 2 月 19 日):
     * "豪威集团 603501 2026 年 2 月 最新公告 重大事件"
     * "韦尔股份 2026 年以来 机构调研 持仓变化"
     * "半导体 CIS 行业 2026 年发展趋势 政策动态"
     * "豪威集团 近 3 个月 主力资金流向 北向资金"
   - **禁止使用模糊时间词**(如"最近"、"近期"),必须根据当前日期计算具体时间范围
   - **搜索内容时间范围**:
     * 公司最新公告和重大事件：**当前月份以来**
     * 行业动态和政策影响：**当前年份以来或近 3 个月**
     * 市场分析师观点和评级：**近 3 个月内**
     * 相关新闻和媒体报道：**当前月份以来**
     * 机构调研和持仓变化：**近 1-3 个月**
     * 主力资金流向和北向资金动向：**近 5 日、10 日、20 日**
   - **报告中必须注明**:
     * 每条信息的来源和具体日期，例如:"根据 2026 年 2 月 18 日上海证券报报道..."
     * 对于传闻或不确定信息，需标注"据媒体统计"或"市场传闻"
     * 对于历史数据回顾，需说明"截至 2025 年 X 季度"或"近 X 个交易日 (2026 年 X 月 X 日-X 月 X 日)"

**第五步：综合融合分析**
5. 将技术面、基本面、财务面和新闻面进行综合融合分析：
   - **数据交叉验证**：对比不同数据源的信息一致性
   - **多维度评分**：基于基本面、技术面、财务面、资金流、情绪面进行量化评分
   - **风险收益评估**：综合评估投资风险和潜在收益
   - **操作建议**：给出明确的买入/卖出/持有建议及理由

**第六步：生成报告**
6. 生成完整的投资分析报告并保存为 Markdown 格式：
   - 报告文件名包含时间戳：`{股票名称或代码}_分析报告_YYYYMMDD_HHMMSS.md`
   - 报告内容必须包含所有分析维度的详细论述
   - 数据来源标注清晰（技术数据来源、财务数据来源、网络信息来源）

- **6位数字代码**: `000001`, `600036`
- **带交易所前缀**: `sz.000001`, `sh.600036`
- **指数代码**: `hs300`, `sz50`, `zz500`
- **大盘分析**: `market`, `index`, `overview`

## 参数说明

| 参数 | 简写 | 说明 | 默认值 |
|------|------|------|--------|
| `<股票代码>` | - | 股票代码（如 000001, 600036） | - |
| `<分析类型>` | - | `info`, `quote`, `comprehensive`, `technical`, `fundamental`, `industry`, `finance`, `report`, `compare_peers`, `capital_flow` | `comprehensive` |
| `--period` | `-p` | 技术分析周期级别：`daily`, `weekly`, `monthly`, `daily_weekly_monthly` | `daily` |
| `--format` | `-f` | 输出格式（`text`/`json`/`csv`） | `text` |
| `--no-cache` | - | 禁用智能缓存 | 启用 |
| `--cache-ttl` | - | 缓存 TTL（小时） | `24` |
| `--verbose` | `-v` | 详细日志输出 | 关闭 |
| `--peers` | - | 同业对比时指定可比公司列表（逗号分隔） | 自动选择 |
| `--flow-type` | - | 资金流分析类型：`main`, `north`, `south`, `all` | `all` |

## 示例

### 场景 1: 个股综合分析

**用户输入**: "分析平安银行 000001"

**执行命令**:
```bash
python3 run_skill.py 000001 comprehensive
```

**AI 输出**: 结合技术数据和网络信息的深度分析报告，包含技术面、基本面、新闻面的综合评估和投资建议。

---

### 场景 2: 技术分析

**用户输入**: "获取平安银行技术指标"

**执行命令**:
```bash
python3 run_skill.py 000001 technical
```

**AI 输出**: MA、RSI、MACD、KDJ 等技术指标分析。

---

### 场景 3: 行业分类分析

**用户输入**: "查看平安银行所属行业"

**执行命令**:
```bash
python3 run_skill.py 000001 industry
```

**AI输出**: 证监会行业分类信息。

---

### 场景 4: 指数成分股查询

**用户输入**: "获取沪深300成分股"

**执行命令**:
```bash
python3 run_skill.py hs300
```

**AI输出**: 沪深300成分股列表。

---

### 场景 5: 财务分析

**用户输入**: "分析招商银行财务状况"

**执行命令**:
```bash
python3 run_skill.py 600036 finance
```

**AI输出**: 财务数据分析（资产负债表、现金流量表、利润表等）。

---

### 场景 6: JSON格式输出

**用户输入**: "以JSON格式输出平安银行数据"

**执行命令**:
```bash
python3 run_skill.py 000001 --format json
```

**AI输出**: 解析JSON数据并按用户需求格式化展示。

---

### 场景 7: 大盘情况报告

**用户输入**: "获取今日大盘情况报告"

**执行命令**:
```bash
python3 run_skill.py market report
```

**AI 输出**: 整合主流财经媒体对大盘走势的分析和投资建议。

---

### 场景 8: 同业横向对比

**用户输入**: “对比三花智控与同行业公司的财务指标”

**执行命令**:
```bash
python3 run_skill.py 002050 compare_peers
```

**AI 输出**: 
- 同行业多公司财务指标对比表（PE、PB、ROE、毛利率等）
- 估值水平横向比较
- 成长性、盈利能力、营运能力排名
- 行业地位分析与投资建议

---

### 场景 9: 资金流专项分析

**用户输入**: “分析三花智控的资金流向”

**执行命令**:
```bash
python3 run_skill.py 002050 capital_flow
```

**AI 输出**: 
- 主力资金流向（大单/超大单净流入流出）
- 北向资金持仓变化趋势
- 南向资金动向（如有）
- 资金流向与技术面背离分析
- 主力意图解读

---

### 场景 10: 技术分析（多周期联合）

**用户输入**: “三花智控日线周线月线综合分析”

**执行命令**:
```bash
python3 run_skill.py 002050 technical --period daily_weekly_monthly
```

**AI 输出**: 
- **日线级别**: 短期趋势、支撑压力、技术指标
- **周线级别**: 中期趋势、关键位置、形态分析
- **月线级别**: 长期趋势、历史位置、大周期判断
- **多周期共振**: 三个级别的信号一致性分析
- **综合判断**: 基于多周期的操作建议

---

## 分析类型

### 1. 基本资料 (info)
- 获取股票基本信息：代码、名称、价格等

### 2. 实时行情 (quote)  
- 获取实时股价、涨跌幅、成交量、成交额等

### 3. 技术分析 (technical)
- MA、RSI、MACD、KDJ 等技术指标

### 4. 基本面分析 (fundamental)
- PE、PB、换手率等基本面指标

### 5. 行业分类 (industry)
- 证监会行业分类信息

### 6. 财务分析 (finance)
- **使用 AKShare 获取完整财务报表数据**
  - 调用 `core/financial_analyzer.py` 的 `get_comprehensive_financial_report()` 方法
  - 直接从 AKShare 获取三大报表的完整绝对值数据
  - **脚本必须格式化输出所有关键数据给 AI**：
    * 完整的 key_metrics 字典（包含所有提取的财务指标）
    * 资产负债表：总资产、总负债、货币资金、应收账款、存货、固定资产、商誉、有息负债等
    * 利润表：营业收入、营业成本、毛利润、净利润、扣非净利润、销售费用、管理费用、研发费用等
    * 现金流量表：经营/投资/筹资现金流净额、销售商品收到的现金等
    * 财务比率：ROE、毛利率、净利率、周转率、增长率等
    * 风险评估：五大黄金标准、快速排雷清单、现金流肖像等
  - **AI 接收数据后，按照 `report/读财报.md` 方法论进行系统分析**：
    * 审计意见检查（一票否决）
    * 资产负债表分析（速读四步法、三类资产质量、负债结构）
    * 利润表分析（核心指标提取、利润质量检验、同比环比）
    * 现金流量表分析（现金流肖像、五大黄金标准、净利润含金量）
    * 造假风险识别（红旗清单、存贷双高、异常科目排查）
    * 杜邦分析（ROE 拆解、盈利模式判断）
    * 估值与击球区计算（PE 估值法、安全边际、买入区间）

### 7. 综合分析 (comprehensive)
- **结合技术数据和网络信息的深度分析，整合前述 1-6 项全部分析内容**

  - **网络信息搜索**: 公司最新公告和重大事件、行业动态和政策影响、市场分析师观点和评级、相关新闻和媒体报道、机构调研和持仓变化
    - **时效性要求**：所有搜索必须限定在**3 个月以内**的最新信息
  - **技术数据获取**: 基本信息（代码、名称、价格等）、技术指标（MA、RSI、MACD、KDJ 等）、基本面数据（PE、PB、换手率等）、行业分类信息等
  - **财务分析**: 
    1. 调用 `core/financial_analyzer.py` 的 `get_comprehensive_financial_report()` 方法获取 AKShare 财务数据
    2. **脚本必须将完整的 key_metrics 字典和三大报表详细数据格式化输出给 AI**
    3. AI 基于获取的完整数据，阅读并分析资产负债表、现金流量表、利润表
  - **综合分析**: 将技术面、基本面、财务面和新闻面进行综合融合分析，生成完整的投资分析报告
  - **输出**: 包含基本资料、实时行情、技术分析、基本面分析、行业分类、财务分析（按《读财报.md》方法论）、市场情绪和新闻面分析、综合投资建议和风险提示的完整报告

### 8. 大盘分析 (report)
- **获取主流财经媒体对大盘走势的分析**
  - **数据源**: 新浪财经、东方财富、同花顺、雪球、华尔街见闻等
  - **内容**: 大盘走势分析、市场情绪、投资策略、风险提示
  - **输出**: 结构化的大盘分析报告，包含宏观趋势、热点板块、投资建议等

### 9. 同业横向对比 (compare_peers)
- **同行业多公司财务指标对比**
  - 自动识别股票所属行业
  - 选取同行业可比公司（通常 5-10 家）
  - 对比关键财务指标：
    - **估值指标**: PE、PB、PEG、PS
    - **盈利能力**: ROE、ROA、毛利率、净利率
    - **成长性**: 营收增长率、净利润增长率
    - **营运能力**: 总资产周转率、存货周转率
    - **偿债能力**: 资产负债率、流动比率
  - **行业排名**: 各项指标的百分位排名
  - **投资建议**: 基于对比的低估值标的推荐

### 10. 资金流专项分析 (capital_flow)
- **主力资金流向分析**
  - 超大单净流入（机构资金）
  - 大单净流入（大户资金）
  - 中单净流入（中户资金）
  - 小单净流入（散户资金）
  - 主力净流入占比成交额
- **北向资金持仓变化**
  - 陆股通持股比例
  - 近 5 日/10 日/30 日持股变化
  - 北向资金买卖金额
  - 外资偏好分析
- **南向资金动向**（如有港股通标的）
  - 港股通持股比例变化
  - 内地资金南下意愿
- **资金流向与技术面背离分析**
  - 资金流入但股价下跌（背离）
  - 资金流出但股价上涨（背离）
  - 主力意图解读
- **资金流向趋势**
  - 近 5 日/10 日/20 日资金流向趋势图
  - 资金流向的持续性分析

### 11. 技术分析 - 多周期联合判断 (technical --period daily_weekly_monthly)
- **日线级别分析**
  - 短期均线系统（MA5/10/20）
  - 日线技术指标（RSI、MACD、KDJ）
  - 短期支撑位与压力位
  - 短期趋势判断（1-4 周）
- **周线级别分析**
  - 中期均线系统（MA5/10/20/30）
  - 周线技术指标
  - 中期关键位置
  - 中期趋势判断（1-3 个月）
- **月线级别分析**
  - 长期均线系统（MA60/120/250）
  - 月线技术指标
  - 历史位置判断
  - 长期趋势判断（3 个月以上）
- **多周期共振分析**
  - 三个级别趋势一致性（同向为共振）
  - 信号强度评估（共振时信号最强）
  - 周期冲突识别（如日线看空、周线看多）
- **综合操作建议**
  - 基于多周期的买入/卖出时机
  - 不同周期的仓位建议
  - 止损止盈位设置

## 功能详解

### 综合分析（个股）

#### 目标
综合分析整合了前述 1-6 项全部分析内容，系统将自动化执行以下步骤：

1. 首先调用 `core/financial_analyzer.py` 获取 AKShare 财务数据：
   - AI 必须主动调用 `get_comprehensive_financial_report()` 方法获取三大报表数据
   - 该方法直接从 AKShare 获取完整的财务报表绝对值数据
2. 然后基于获取的财务数据，按照`report/读财报.md`方法论深度分析财报
3. 再使用现有的 Python 脚本获取股票的技术数据，包括基本信息（代码、名称、价格等）、技术指标（MA、RSI、MACD、KDJ 等）、基本面数据（PE、PB、换手率等）、行业分类信息等
4. **然后 AI 必须调用内置的 `search_web` 工具**，搜索与该股票或相关板块相关的最新网络信息，包括公司最新公告和重大事件、行业动态和政策影响、市场分析师观点和评级、相关新闻和媒体报道、机构调研和持仓变化
5. 最后将技术面、基本面、财务面和新闻面进行综合融合分析，生成一份完整的投资分析报告，并保存为 Markdown 格式文件

#### 技术实现
- **技术数据获取**: 通过现有的 baostock 数据接口获取实时行情、技术指标、基本面数据和行业分类信息
- **财务数据获取**: 
  - 使用 `core/financial_analyzer.py` 的 `get_comprehensive_financial_report()` 方法
  - 直接从 AKShare 获取完整的三大报表绝对值数据
  - 数据包括：资产负债表、利润表、现金流量表的详细科目
- **财报深度分析**: 按照`report/读财报.md`方法论，进行系统化财务分析
- **网络信息搜索**: 当 Python 脚本输出技术数据和财报数据后，AI 在接收到综合分析请求时，**必须自动调用内置的 `search_web` 工具（注意时效性）**，搜索与股票相关的最新网络信息。**所有搜索必须限定在 3 个月以内的最新信息**。搜索查询应包括但不限于：
  - `{股票名称} {股票代码} 股票 最新公告 重大事件`
  - `{股票名称} {股票代码} 行业动态 政策影响 发展趋势`
  - `{股票名称} {股票代码} 分析师评级 目标价 投资建议`
  - `{股票名称} {股票代码} 机构调研 持仓变化 北向资金`
  - `{所属行业} 发展趋势 市场前景`
- **综合分析**: AI 将技术数据（来自 baostock）、财务数据（来自巨潮资讯网财报深度分析）和网络信息（来自 `search_web` 工具搜索）进行融合分析，生成包含多维度信息的投资建议

#### 数据内容
- **技术面分析**: MA、RSI、MACD、KDJ 等技术指标分析
- **基本面分析**: PE、PB、换手率等基本面指标分析
- **财务面分析**：按照`report/读财报.md`方法论深度分析财报结果
- **新闻面分析**: 公司公告、行业动态、分析师观点等信息分析
- **综合投资建议**: 基于技术面、基本面、财务面和新闻面的综合判断
- **风险提示**: 基于多维度分析的风险评估

#### 输出格式
完整的综合分析报告应包含以下结构：
- **股票基本信息**: 股票代码、名称、当前价格、涨跌幅等
- **技术面分析**: MA、RSI、MACD、KDJ 等技术指标详细分析
- **基本面分析**: PE、PB、换手率等基本面指标分析
- **财报分析**：按照 `report/读财报.md` 中的方法论对个股财报的分析
- **新闻面分析**: 公司公告、行业动态、分析师观点等内容摘要
- **市场情绪评估**: 基于新闻和市场信息的情绪分析
- **综合投资建议**: 结合技术面、基本面和新闻面的买入/卖出/持有建议
- **风险提示**: 基于多维度分析的风险评估
- **数据来源说明**: 技术数据来源（baostock）、财务数据来源（AKShare）、网络信息来源（search_web 搜索）标注
- **报告时间戳**: 所有报告必须使用 Markdown 格式新建文件保存，文件名包含日期时间，格式为 `{股票名称或代码}_分析报告_YYYYMMDD_HHMMSS.md`
- **财务数据来源**: AKShare（直接获取三大报表绝对值数据）

### 大盘分析（市场）

#### 目标
AI 直接使用内置搜索工具获取最新市场行情，不再依赖脚本数据源，生成专业的市场分析报告。

#### 技术实现
- **时间判断**: 根据当前时间自动判断市场状态
  - **开盘前**(上午9:30之前): 搜索并使用前一交易日的收盘数据生成报告
  - **交易中**(上午9:30至下午3:00): 获取并报告当前实时市场数据
  - **收盘后**(下午3:00之后): 获取并报告当日最终收盘数据
- **信息整合**: 综合用户输入、当前时间和上下文信息
- **网络搜索**: 
  - **开盘前**: 搜索"{前一交易日日期} A股收盘 上证指数 深证成指 创业板指 沪深300"等相关信息
  - **交易中**: 搜索"今日 A股实时 上证指数 深证成指 创业板指 沪深300"等相关信息
  - **收盘后**: 搜索"{当前日期} A股收盘 上证指数 深证成指 创业板指 沪深300"等相关信息
- **数据核实**: 对所有关键统计数据进行全面核实，确保数据准确性
- **AI分析**: 基于搜索结果和当前市场状态直接生成分析报告
- **格式化输出**: 生成适合公众号发布的精美 Markdown 格式报告

#### 数据内容
- **当日大盘走势**: 主要指数表现情况
- **市场热点板块**: 领涨领跌板块分析
- **资金流向**: 北向资金、主力资金动向
- **市场情绪评估**: 投资者情绪和市场氛围分析
- **后市展望**: 技术面分析和操作建议

#### 输出格式
AI 生成结构化的 Markdown 报告，包含：
- 适当的标题层级
- 清晰的列表和表格
- 专业的引用和注释
- 适合公众号发布的视觉效果
- **报告时间戳**: 所有报告必须使用 Markdown 格式新建文件保存，文件名包含日期时间，格式为 `大盘分析报告_YYYYMMDD_HHMMSS.md`

## 报告结构模板

#### 个股综合分析报告模板
完整的综合分析报告应包含以下结构：
- **股票基本信息**: 股票代码、名称、当前价格、涨跌幅等
  - **必须注明数据时间**: "截至 [最新交易日] 收盘"或类似说明
- **技术面分析**: MA、RSI、MACD、KDJ 等技术指标详细分析
  - **必须注明数据时间**: "截至 [最新交易日] "或"近 X 个交易日"
- **基本面分析**: PE、PB、换手率等基本面指标分析
  - **必须注明数据时间**: "TTM 数据 (截至 [最新财报季度])"
- **财报深度分析**：按照 `report/读财报.md` 标准
  - **必须明确说明**: "基于 [最新财报报告期，如 2025 年第三季度报告]"
- **新闻面分析**: 公司公告、行业动态、分析师观点等内容摘要
  - **每条信息必须注明来源和时间**: "据 [具体日期，如 2026 年 2 月 18 日] 证券时报报道..."
  - **禁止使用模糊表述**: 如"近日"、"近期",应具体到"[当前月份] 上旬/中旬/下旬"
- **市场情绪评估**: 基于新闻和市场信息的情绪分析
  - **注明统计时间段**: "近 5 个交易日 ([起始日期]-[结束日期])"
- **综合投资建议**: 结合技术面、基本面、财务面和新闻面的买入/卖出/持有建议
  - **建议需注明时效性**: "短期 (1-3 个月) 建议"或"中长期 (6 个月以上) 建议"
- **风险提示**: 基于多维度分析的风险评估
  - **区分风险类型**: "短期风险 (股东解禁)"vs"长期风险 (技术迭代)"
- **数据来源说明**: 技术数据来源（baostock）、财务数据来源（AKShare）、网络信息来源（search_web 搜索）标注
  - **所有数据源均需注明时间**: "技术数据来自 baostock([最新交易日])、财务数据来自 AKShare([最新财报报告期])"

#### 市场分析报告模板
完整的市场分析报告应包含以下结构：
- **主要指数表现**: 上证指数、深证成指、创业板指、科创板指的详细分析
  - **必须注明交易日期**: "[当前日期]，上证指数..."
- **市场概况**: 成交量分析、涨跌分布、涨停/跌停股票统计
  - **注明统计日期**: "[当前日期] 收盘数据"
- **板块表现分析**: 强势板块和弱势板块的详细分析
  - **注明时间段**: "近 5 个交易日 ([起始日期]-[结束日期]) 板块涨幅榜"
- **资金流向分析**: 北向资金、主力资金、两融资金流向
  - **注明统计周期**: "近 5 日主力净流入 XX 亿元 ([起始日期].[月份].[日期]-[结束日期].[月份].[日期])"
- **市场统计分析**: 关键数据核实与统计指标
  - **数据来源和时间**: "据 Wind 统计，截至 [当前日期]..."
- **市场情绪评估**: 投资者情绪与风险偏好分析
  - **注明观察期**: "从 [当前月份] 以来市场情绪变化看..."
- **重要事件与消息面**: 政策动态、海外市场影响、公司动态
  - **每条消息需注明时间**: "[具体日期]，央行宣布..."
- **后市展望与操作建议**: 技术面分析、基本面评估、操作策略建议
  - **建议需明确时间框架**: "短期 (下周) 关注 XXX"、"中期 (一季度) 配置 XXX"


## 评分模型

### 权重分配

#### 综合分析评分（默认）
- **基本面评分**: 35%
- **技术面评分**: 25% 
- **财务面评分**: 25%
- **资金流评分**: 10%
- **情绪面评分**: 5%

#### 同业对比评分
- **估值优势**: 30%（PE、PB、PEG 等相对行业平均的折溢价）
- **盈利能力**: 25%（ROE、毛利率、净利率行业排名）
- **成长性**: 25%（营收增速、利润增速行业排名）
- **营运能力**: 10%（周转率、费用率）
- **偿债能力**: 10%（负债率、流动比率）

#### 技术面多周期评分
- **日线级别**: 40%（短期趋势强度）
- **周线级别**: 35%（中期趋势强度）
- **月线级别**: 25%（长期趋势强度）
- **共振加分**: 三个周期同向时额外 +10 分

### 风险等级
- **9-10 分**: 低风险（强烈推荐）
- **7-8 分**: 中低风险（推荐）
- **5-6 分**: 中高风险（谨慎推荐）
- **3-4 分**: 高风险（观望）
- **1-2 分**: 极高风险（回避）

## 操作建议

### 综合分析建议
- **买入**: 技术面强势 + 基本面良好 + 市场情绪积极 + 资金流入时建议买入
- **卖出**: 技术面破位 + 基本面恶化 + 市场情绪转差 + 资金流出时建议卖出
- **持有**: 震荡行情或不确定性强时建议持有观望

### 同业对比建议
- **首选标的**: 综合评分排名前 20% 且估值合理的公司
- **分散配置**: 同一行业选择 2-3 家不同细分领域的龙头
- **动态调整**: 每季度根据最新财报重新评估行业排名

### 多周期技术面建议
- **日线买点**: 日线发出买入信号，周线/月线不冲突时
- **周线买点**: 周线趋势向上，日线回调至支撑位时
- **月线买点**: 月线处于历史低位，日线/周线出现拐点时
- **共振机会**: 三个周期同时发出同向信号时为最佳时机
- **周期冲突**: 大周期与小周期信号相反时，优先服从大周期

## 依赖安装

```bash
# 基础依赖（必需）
 -m pip install -i https://mirrors.aliyun.com/pypi/simple --break-system-packages baostock pandas numpy

# 完整依赖（推荐）
python3 -m pip install -i https://mirrors.aliyun.com/pypi/simple --break-system-packages -r requirements.txt 

# 包含:
# - baostock >= 0.8.90 (A股数据源)
# - pandas >= 1.5.0 (数据处理)
# - numpy >= 1.21.0 (数值计算)
# - matplotlib >= 3.5.0 (可视化)
# - seaborn >= 0.11.0 (统计图表)
# - aiohttp >= 3.9.0 (异步爬虫)
# - beautifulsoup4 >= 4.12.0 (HTML解析)
```

## 注意事项

1. **首次运行**: 需要先安装依赖 `pip install -r requirements.txt`
2. **数据源**: 个股分析使用 baostock 作为数据源；大盘分析和综合分析 AI 直接使用内置搜索工具获取实时数据
3. **缓存机制**: 默认启用 24 小时缓存，使用 `--no-cache` 禁用
4. **股票代码**: 支持 6 位数字代码或带交易所前缀格式
5. **输出格式**: 支持 text、json、csv 三种格式
6. **股票代码查询**: 使用 `search_web` 工具搜索股票的代码。
7. **AI 处理流程**:
   - **大盘分析**: AI 使用 `search_web` 工具搜索市场信息并生成报告，**特别注意时效性**
     * **AI 必须先获取当前日期**,然后在搜索查询中注明具体日期
     * **报告中所有数据均需注明交易日期**
   - **行业分析**：AI 使用 `search_web` 工具搜索市场信息并生成报告，**特别注意时效性**
     * **必须注明统计时间段**,如"[当前年份] 年以来半导体行业政策汇总"
   - **个股综合分析**: AI 必须执行以下步骤：
     a. 接收 Python 脚本输出的技术数据（来自 baostock）
        - **技术数据需注明时间**: "截至 [最新交易日] 收盘"
     b. **必须调用 `core/financial_analyzer.py` 的 `get_comprehensive_financial_report()` 方法获取 AKShare 财务数据**
        - 该方法直接返回三大报表的完整绝对值数据
        - 数据格式为字典，包含 'balance_sheet', 'income_statement', 'cash_flow' 等键
        - **财报数据需注明报告期**: "基于 [最新财报报告期]"
     c. **必须按照 `report/读财报.md` 方法论深度分析财报数据**
        - **所有分析结论需注明数据来源和时间**
     d. **调用 `search_web` 工具（注意时效性）**搜索网络信息（公司公告、行业动态、分析师观点等）
        - **AI 必须先获取当前日期**,然后基于当前日期生成搜索查询
        - **搜索查询示例**: "[股票名称] [股票代码] [当前月份] 最新公告"、"[股票名称] 近 3 个月 机构调研"
        - **禁止使用模糊时间词**: "最近"、"近期"、"最新"等，必须根据当前日期计算具体时间范围
     e. 将技术面、基本面、财务面和新闻面进行综合融合分析
        - **区分数据时效**: 技术面 (最新交易日)、财务面 (滞后，最新报告期)、消息面 (实时，近 1-3 个月)
     f. **生成 Markdown 格式分析报告**，文件名包含时间戳
        - **报告正文中所有数据和信息均需注明来源和时间**