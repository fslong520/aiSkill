---
name: 股票研究

description: |
  增强型股票研究技能，提供实时行情、技术分析、财务分析、行业分类和大盘分析功能。
  从baostock获取A股实时数据，计算MA、RSI、MACD、KDJ等技术指标，
  提供多维度量化评分模型和投资建议。支持基本面分析、财务数据评估、
  行业分类查询和指数成分股分析。通过爬取主流财经媒体获取市场分析和投资建议，
  提供综合性的投资决策支持。适用于个股分析、市场趋势跟踪、财务评估、
  大盘走势分析和投资策略制定等场景。支持多种输出格式和缓存机制，
  确保数据的实时性和分析的准确性。

allowed-tools:
  - Read
  - Write
  - Edit
  - AskUserQuestion

metadata:
  trigger: 股票分析、技术指标、财务评估、行业分类、投资建议、大盘分析
  source: 基于baostock数据接口和财经网络爬虫技术，整合量化分析模型
---

# Stock Research

A股智能分析系统 - 支持实时行情、技术分析、财务分析、行业分类和大盘分析。

## 目标

从baostock实时获取A股数据，支持：
- 实时行情（股价、涨跌幅、成交量等）
- 技术分析（MA、RSI、MACD、KDJ等指标）
- 财务分析（资产负债表、现金流量表、利润表）
- 行业分类（证监会行业分类）
- 量化评分（多维度评分模型）
- 操作建议（买入/卖出/持有建议）
- **大盘分析**（获取主流财经媒体对大盘走势的分析和投资建议）
- **综合分析**（结合技术数据和网络信息的深度分析）

## 执行流程

### 1. 识别用户意图

根据用户输入确定：
- **股票代码**: 个股分析 / 指数成分股
- **分析类型**: 技术分析 / 基本面分析 / 财务分析 / 综合分析
- **输出需求**: 简要报告 / 详细分析 / 数据表格
- **大盘分析**: 宏观走势 / 市场情绪 / 投资策略
### 2. 构建命令

**基础命令模板**:
```bash
python3 run_skill.py <股票代码> [选项] [参数]
```

**常用场景映射**:

| 用户需求 | 股票代码 | 关键参数 |
|---------|--------|----------|
| 个股综合分析 | `000001` | 无 |
| 技术分析 | `000001` | `technical` |
| 基本面分析 | `000001` | `fundamental` |
| 行业分类 | `000001` | `industry` |
| 财务分析 | `000001` | `finance` |
| 指数成分股 | `hs300` | 无 |
| 大盘分析 | **market** | **`report`** |

### 3. 执行命令

**常用命令**:
```bash
# 个股综合分析（技术面 + 基本面 + 新闻面）
python3 run_skill.py 000001 comprehensive

# 技术分析
python3 run_skill.py 000001 technical

# 基本面分析
python3 run_skill.py 000001 fundamental

# 行业分类
python3 run_skill.py 000001 industry

# 财务分析
python3 run_skill.py 600036 finance

# 指数成分股
python3 run_skill.py hs300

# 大盘分析
python3 run_skill.py market report
```


### 3. 项目结构

```
stocktourch/
├── run_skill.py          # 入口脚本
├── SKILL.md              # 技能定义
├── requirements.txt      # 依赖
│
├── core/                 # 核心分析器
│   ├── stock_analyzer.py      # 股票分析器
│   ├── financial_analyzer.py  # 财务分析器
│   ├── market_analyzer.py     # 大盘分析器
│   └── ai_market_analyzer.py  # AI市场分析器
│
├── utils/                # 工具模块
│   ├── config.py             # 配置
│   ├── utils.py              # 工具函数
│   ├── cache_manager.py      # 缓存管理
│   └── output_formatter.py   # 输出格式化
│
├── report/               # 财报模块
│   ├── cninfo_downloader.py # 巨潮资讯下载器
│   └── report_reader.py     # PDF读取器
│
├── web/                 # 网络模块
│   └── web_crawler.py       # 网页爬虫
│
├── executor/             # 执行器
│   └── skill_executor.py   # 技能执行器
│
└── assets/              # 资源文件
    ├── stocks.json               # 股票数据库
    └── financial_analyst_prompt.txt
```


### 4. 处理输出

- 对于大盘分析，AI直接使用内置搜索工具获取实时市场数据
- AI 负责理解数据并按照用户需求进行格式化输出
- AI 根据上下文提供适当的分析和建议
- **对于综合分析**，系统将自动执行以下步骤：
  1. 使用现有 Python 脚本获取技术数据（基本信息、技术指标、基本面数据、行业分类等）
  2. 调用 AI 内置网络搜索功能，搜索与该股票或相关板块相关的最新网络信息
  3. 将技术数据和网络信息进行综合分析，生成完整的投资分析报告

- **6位数字代码**: `000001`, `600036`
- **带交易所前缀**: `sz.000001`, `sh.600036`
- **指数代码**: `hs300`, `sz50`, `zz500`
- **大盘分析**: `market`, `index`, `overview`

## 参数说明

| 参数 | 简写 | 说明 | 默认值 |
|------|------|------|--------|
| `<股票代码>` | - | 股票代码（如 000001, 600036） | - |
| `<分析类型>` | - | `info`, `quote`, `comprehensive`, `technical`, `fundamental`, `industry`, `finance`, `report` | `comprehensive` |
| `--format` | `-f` | 输出格式（`text`/`json`/`csv`） | `text` |
| `--no-cache` | - | 禁用智能缓存 | 启用 |
| `--cache-ttl` | - | 缓存 TTL（小时） | `24` |
| `--verbose` | `-v` | 详细日志输出 | 关闭 |

## 示例

### 场景 1: 个股综合分析

**用户输入**: "分析平安银行 000001"

**执行命令**:
```bash
python3 run_skill.py 000001 comprehensive
```

**AI 输出**: 结合技术数据和网络信息的深度分析报告，包含技术面、基本面、新闻面的综合评估和投资建议。

---

### 场景 2: 技术分析

**用户输入**: "获取平安银行技术指标"

**执行命令**:
```bash
python3 run_skill.py 000001 technical
```

**AI 输出**: MA、RSI、MACD、KDJ 等技术指标分析。

---

### 场景 3: 行业分类分析

**用户输入**: "查看平安银行所属行业"

**执行命令**:
```bash
python3 run_skill.py 000001 industry
```

**AI输出**: 证监会行业分类信息。

---

### 场景 4: 指数成分股查询

**用户输入**: "获取沪深300成分股"

**执行命令**:
```bash
python3 run_skill.py hs300
```

**AI输出**: 沪深300成分股列表。

---

### 场景 5: 财务分析

**用户输入**: "分析招商银行财务状况"

**执行命令**:
```bash
python3 run_skill.py 600036 finance
```

**AI输出**: 财务数据分析（资产负债表、现金流量表、利润表等）。

---

### 场景 6: JSON格式输出

**用户输入**: "以JSON格式输出平安银行数据"

**执行命令**:
```bash
python3 run_skill.py 000001 --format json
```

**AI输出**: 解析JSON数据并按用户需求格式化展示。

---

### 场景 7: 大盘情况报告

**用户输入**: "获取今日大盘情况报告"

**执行命令**:
```bash
python3 run_skill.py market report
```

**AI 输出**: 整合主流财经媒体对大盘走势的分析和投资建议。

---

## 分析类型

### 1. 基本资料 (info)
- 获取股票基本信息：代码、名称、价格等

### 2. 实时行情 (quote)  
- 获取实时股价、涨跌幅、成交量、成交额等

### 3. 技术分析 (technical)
- MA、RSI、MACD、KDJ 等技术指标

### 4. 基本面分析 (fundamental)
- PE、PB、换手率等基本面指标

### 5. 行业分类 (industry)
- 证监会行业分类信息

### 6. 财务分析 (finance)
- **使用 report 目录下的脚本下载财报并深度分析**
  - 调用 `cninfo_downloader.py` 从巨潮资讯网下载最新年报/季报 PDF
  - 使用 `report_reader.py` 提取财报关键数据和文本内容
- **按照`report/读财报.md`方法论进行系统分析**：
  - 审计意见检查（一票否决）
  - 资产负债表分析（速读四步法、三类资产质量、负债结构）
  - 利润表分析（核心指标提取、利润质量检验、同比环比）
  - 现金流量表分析（现金流肖像、五大黄金标准、净利润含金量）
  - 造假风险识别（红旗清单、存贷双高、异常科目排查）
  - 杜邦分析（ROE 拆解、盈利模式判断）
  - 估值与击球区计算（PE 估值法、安全边际、买入区间）

### 7. 综合分析 (comprehensive)
- **结合技术数据和网络信息的深度分析，整合前述 1-6 项全部分析内容**

  - **网络信息搜索**: 公司最新公告和重大事件、行业动态和政策影响、市场分析师观点和评级、相关新闻和媒体报道、机构调研和持仓变化
  - **技术数据获取**: 基本信息（代码、名称、价格等）、技术指标（MA、RSI、MACD、KDJ 等）、基本面数据（PE、PB、换手率等）、行业分类信息等
  - **财务分析**: 通过脚本从巨潮资讯网下载财报 PDF，AI 阅读并分析资产负债表、现金流量表、利润表
  - **综合分析**: 将技术面、基本面、财务面和新闻面进行综合融合分析，生成完整的投资分析报告
  - **输出**: 包含基本资料、实时行情、技术分析、基本面分析、行业分类、财务分析、市场情绪和新闻面分析、综合投资建议和风险提示的完整报告

### 8. 大盘分析 (report)
- **获取主流财经媒体对大盘走势的分析**
  - **数据源**: 新浪财经、东方财富、同花顺、雪球、华尔街见闻等
  - **内容**: 大盘走势分析、市场情绪、投资策略、风险提示
  - **输出**: 结构化的大盘分析报告，包含宏观趋势、热点板块、投资建议等

## 功能详解

### 综合分析（个股）

#### 目标
综合分析整合了前述 1-6 项全部分析内容，系统将自动化执行以下步骤：
1. 首先使用现有的 Python 脚本获取股票的技术数据，包括基本信息（代码、名称、价格等）、技术指标（MA、RSI、MACD、KDJ 等）、基本面数据（PE、PB、换手率等）、行业分类信息等
2. **必须调用 report 目录下的脚本下载最新财报 PDF**：
   - AI 必须主动调用 `cninfo_downloader.py` 从巨潮资讯网下载公司最新年报/季报 PDF
   - AI 必须使用 `report_reader.py` 提取财报关键数据和文本内容
3. **必须按照`report/读财报.md`方法论深度分析财报**：
   - 审计意见检查（一票否决）
   - 资产负债表分析（资产质量、负债结构、三类资产排雷）
   - 利润表分析（盈利能力、利润质量、同比环比趋势）
   - 现金流量表分析（现金流肖像、五大黄金标准、净利润含金量）
   - 造假风险识别（红旗清单、存贷双高、异常科目排查）
   - 杜邦分析（ROE 拆解、盈利模式判断）
4. **然后 AI 必须调用内置的 `search_web` 工具**，搜索与该股票或相关板块相关的最新网络信息，包括公司最新公告和重大事件、行业动态和政策影响、市场分析师观点和评级、相关新闻和媒体报道、机构调研和持仓变化
5. 最后将技术面、基本面、财务面和新闻面进行综合融合分析，生成一份完整的投资分析报告，并保存为 Markdown 格式文件

#### 技术实现
- **技术数据获取**: 通过现有的 baostock 数据接口获取实时行情、技术指标、基本面数据和行业分类信息
- **财报下载与提取**: 
  - 使用 `report/cninfo_downloader.py` 从巨潮资讯网下载最新财报 PDF
  - 使用 `report/report_reader.py` 提取财报关键数据和文本内容
- **财报深度分析**: 按照`report/读财报.md`方法论，进行系统化财务分析
- **网络信息搜索**: 当 Python 脚本输出技术数据和财报数据后，AI 在接收到综合分析请求时，**必须自动调用内置的 `search_web` 工具（注意时效性）**，搜索与股票相关的最新网络信息。搜索查询应包括但不限于：
  - `{股票名称} {股票代码} 股票 最新公告 重大事件`
  - `{股票名称} {股票代码} 行业动态 政策影响 发展趋势`
  - `{股票名称} {股票代码} 分析师评级 目标价 投资建议`
  - `{股票名称} {股票代码} 机构调研 持仓变化 北向资金`
  - `{所属行业} 发展趋势 市场前景`
- **综合分析**: AI 将技术数据（来自 baostock）、财务数据（来自巨潮资讯网财报深度分析）和网络信息（来自 `search_web` 工具搜索）进行融合分析，生成包含多维度信息的投资建议

#### 数据内容
- **技术面分析**: MA、RSI、MACD、KDJ 等技术指标分析
- **基本面分析**: PE、PB、换手率等基本面指标分析
- **财务面分析**：按照`report/读财报.md`方法论深度分析财报结果
- **新闻面分析**: 公司公告、行业动态、分析师观点等信息分析
- **综合投资建议**: 基于技术面、基本面、财务面和新闻面的综合判断
- **风险提示**: 基于多维度分析的风险评估

#### 输出格式
完整的综合分析报告应包含以下结构：
- **股票基本信息**: 股票代码、名称、当前价格、涨跌幅等
- **技术面分析**: MA、RSI、MACD、KDJ 等技术指标详细分析
- **基本面分析**: PE、PB、换手率等基本面指标分析
- **财报分析**：按照 `report/读财报.md` 中的方法论对个股财报的分析
- **新闻面分析**: 公司公告、行业动态、分析师观点等内容摘要
- **市场情绪评估**: 基于新闻和市场信息的情绪分析
- **综合投资建议**: 结合技术面、基本面和新闻面的买入/卖出/持有建议
- **风险提示**: 基于多维度分析的风险评估
- **数据来源说明**: 技术数据来源（baostock）、财务数据来源（巨潮资讯网）、网络信息来源（search_web 搜索）标注
- **报告时间戳**: 所有报告必须使用 Markdown 格式保存，文件名包含日期时间，格式为 `{股票名称或代码}_分析报告_YYYYMMDD_HHMMSS.md`

### 大盘分析（市场）

#### 目标
AI 直接使用内置搜索工具获取最新市场行情，不再依赖脚本数据源，生成专业的市场分析报告。

#### 技术实现
- **时间判断**: 根据当前时间自动判断市场状态
  - **开盘前**(上午9:30之前): 搜索并使用前一交易日的收盘数据生成报告
  - **交易中**(上午9:30至下午3:00): 获取并报告当前实时市场数据
  - **收盘后**(下午3:00之后): 获取并报告当日最终收盘数据
- **信息整合**: 综合用户输入、当前时间和上下文信息
- **网络搜索**: 
  - **开盘前**: 搜索"{前一交易日日期} A股收盘 上证指数 深证成指 创业板指 沪深300"等相关信息
  - **交易中**: 搜索"今日 A股实时 上证指数 深证成指 创业板指 沪深300"等相关信息
  - **收盘后**: 搜索"{当前日期} A股收盘 上证指数 深证成指 创业板指 沪深300"等相关信息
- **数据核实**: 对所有关键统计数据进行全面核实，确保数据准确性
- **AI分析**: 基于搜索结果和当前市场状态直接生成分析报告
- **格式化输出**: 生成适合公众号发布的精美 Markdown 格式报告

#### 数据内容
- **当日大盘走势**: 主要指数表现情况
- **市场热点板块**: 领涨领跌板块分析
- **资金流向**: 北向资金、主力资金动向
- **市场情绪评估**: 投资者情绪和市场氛围分析
- **后市展望**: 技术面分析和操作建议

#### 输出格式
AI 生成结构化的 Markdown 报告，包含：
- 适当的标题层级
- 清晰的列表和表格
- 专业的引用和注释
- 适合公众号发布的视觉效果
- **报告时间戳**: 所有报告必须使用 Markdown 格式保存，文件名包含日期时间，格式为 `大盘分析报告_YYYYMMDD_HHMMSS.md`

## 报告结构模板

#### 个股综合分析报告模板
完整的综合分析报告应包含以下结构：
- **股票基本信息**: 股票代码、名称、当前价格、涨跌幅等
- **技术面分析**: MA、RSI、MACD、KDJ 等技术指标详细分析
- **基本面分析**: PE、PB、换手率等基本面指标分析
- **财务面深度分析**（按照《手把手教你读财报》标准）：
  - 审计意见检查及风险评估
  - 资产负债表分析（资产总貌、三类资产质量、负债结构）
  - 利润表分析（盈利能力、利润质量、历史趋势）
  - 现金流量表分析（现金流肖像、五大黄金标准、净利润含金量）
  - 造假风险排查（红旗清单检查结果）
  - 杜邦分析 ROE 拆解
  - 估值与击球区计算（合理 PE、安全边际、买入价格区间）
- **新闻面分析**: 公司公告、行业动态、分析师观点等内容摘要
- **市场情绪评估**: 基于新闻和市场信息的情绪分析
- **综合投资建议**: 结合技术面、基本面、财务面和新闻面的买入/卖出/持有建议
- **风险提示**: 基于多维度分析的风险评估
- **数据来源说明**: 技术数据来源（baostock）、财务数据来源（巨潮资讯网）、网络信息来源（search_web 搜索）标注

#### 市场分析报告模板
完整的市场分析报告应包含以下结构：
- **主要指数表现**: 上证指数、深证成指、创业板指、科创板指的详细分析
- **市场概况**: 成交量分析、涨跌分布、涨停/跌停股票统计
- **板块表现分析**: 强势板块和弱势板块的详细分析
- **资金流向分析**: 北向资金、主力资金、两融资金流向
- **市场统计分析**: 关键数据核实与统计指标
- **市场情绪评估**: 投资者情绪与风险偏好分析
- **重要事件与消息面**: 政策动态、海外市场影响、公司动态
- **后市展望与操作建议**: 技术面分析、基本面评估、操作策略建议


## 评分模型

### 权重分配
- **基本面评分**: 40%
- **技术面评分**: 35% 
- **情绪面评分**: 25%

### 风险等级
- **9-10分**: 低风险
- **7-8分**: 中低风险
- **5-6分**: 中高风险
- **3-4分**: 高风险
- **1-2分**: 极高风险

## 操作建议

- **买入**: 技术面强势+基本面良好+市场情绪积极时建议买入
- **卖出**: 技术面破位+基本面恶化+市场情绪转差时建议卖出
- **持有**: 震荡行情或不确定性强时建议持有观望

## 依赖安装

```bash
# 基础依赖（必需）
 -m pip install -i https://mirrors.aliyun.com/pypi/simple --break-system-packages baostock pandas numpy

# 完整依赖（推荐）
python3 -m pip install -i https://mirrors.aliyun.com/pypi/simple --break-system-packages -r requirements.txt 

# 包含:
# - baostock >= 0.8.90 (A股数据源)
# - pandas >= 1.5.0 (数据处理)
# - numpy >= 1.21.0 (数值计算)
# - matplotlib >= 3.5.0 (可视化)
# - seaborn >= 0.11.0 (统计图表)
# - aiohttp >= 3.9.0 (异步爬虫)
# - beautifulsoup4 >= 4.12.0 (HTML解析)
```

## 注意事项

1. **首次运行**: 需要先安装依赖 `pip install -r requirements.txt`
2. **数据源**: 个股分析使用 baostock 作为数据源；大盘分析和综合分析 AI 直接使用内置搜索工具获取实时数据
3. **缓存机制**: 默认启用 24 小时缓存，使用 `--no-cache` 禁用
4. **股票代码**: 支持 6 位数字代码或带交易所前缀格式
5. **输出格式**: 支持 text、json、csv 三种格式
6. **股票代码查询**: 使用 `search_web` 工具搜索股票的代码。
7. **AI 处理流程**:
   - **大盘分析**: AI 使用 `search_web` 工具搜索市场信息并生成报告，**特别注意时效性**
   - **行业分析**：AI 使用 `search_web` 工具搜索市场信息并生成报告，**特别注意时效性**
   - **个股综合分析**: AI 必须执行以下步骤：
     a. 接收 Python 脚本输出的技术数据（来自 baostock）
     b. **必须调用 `report/cninfo_downloader.py` 下载最新财报 PDF**
     c. **必须使用 `report/report_reader.py` 提取财报关键数据**
     d. **必须按照 `report/读财报.md` 方法论深度分析财报**
     e. **调用 `search_web` 工具（注意时效性）**搜索网络信息（公司公告、行业动态、分析师观点等）
     f. 将技术面、基本面、财务面和新闻面进行综合融合分析
     g. **生成 Markdown 格式分析报告**，文件名包含时间戳