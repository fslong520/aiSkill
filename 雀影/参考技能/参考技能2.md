## Step 1：故事理解 + 风格智能匹配 + 梁概确认

### 任务
分析用户输入的故事内容，智能匹配叙事风格，并生成完整故事梁概让用户确认。

### 接受的输入格式
用户可能提供以下任意一种：
- **一句话灵感**：如「一个AI觉醒后选择保护人类」
- **故事概要**：100-300字的剧情梁概
- **完整剧本**：包含场景、对白的详细脚本
- **参考图片**：用户可能提供一张图片作为视觉参考

### 执行流程

#### 第一阶段：解析故事 + 匹配风格
1. **解析故事核心**：提取主题、情感基调、核心冲突、目标受众
2. **智能匹配风格**：根据故事特征，从以下风格库中推荐 1-2 个最匹配的风格：

| 风格类型 | 代表作/特点 | 适用题材 |
|---------|-----------|----------|
| 悬念反转 | 希区柯克、诺兰 | 悬疑、烧脑、反转 |
| 温情治愈 | 欧·亨利、宫崎骏 | 亲情、成长、日常 |
| 黑色幽默 | 科恩兄弟、昆汀 | 讽刺、荒诞、暴力美学 |
| 儿童奇幻 | 罗尔德·达尔、皮克斯 | 童话、冒险、奇思妙想 |
| 纪录片写实 | BBC纪录片、《人生一串》 | 人物故事、真实事件 |
| 史诗叙事 | 《指环王》、《沙丘》 | 宏大世界观、英雄旅程 |
| 赛博朋克 | 《银翼杀手》、《攻壳机动队》 | 科幻、AI、未来社会 |
| 东方意境 | 王家卫、侯孝贤 | 情感留白、诗意表达 |
| 快节奏剪辑 | 抖音爆款、MV风格 | 产品展示、节奏感强 |

3. **输出风格推荐**，请用户确认或选择其他风格

输出格式：
```
📖 故事解析
- 核心主题：...
- 情感基调：...
- 目标受众：...

🎬 推荐风格：【风格名称】
- 推荐理由：...
- 该风格特点：...

请确认这个风格，或告诉我你想要的其他风格～
```

#### 第二阶段：生成故事梁概并确认
用户确认风格后，根据用户输入的原始素材（一句话/概要/图片等），生成一个完整的 **故事梁概**（100-200字），包含：
- 故事背景
- 主要角色
- 核心冲突/转折
- 情感落点/结局

输出格式：
```
📜 故事梁概

【在此写出100-200字的完整故事梁概】

这个故事可以吗？如需调整请告诉我～
```

### 注意
- 必须先等用户确认风格，再生成故事梁概
- 必须等用户确认故事梁概后，才能进入下一步
- 如果用户的故事过于简短，可以追问补充细节

## Step 2：生成文字素材包

### 前置条件
用户已在 Step 1 确认了叙事风格和故事梁概。

### 任务
根据确认的故事内容和风格，生成完整的文字素材包。

### 视频时长规则
- **默认时长**：15秒（AI视频单次生成上限）
- **内容过长处理**：如果故事内容需要超过15秒才能讲完，必须先询问用户：「这个故事建议拆分成 X 个15秒片段，是否继续？」，获得确认后再生成分段脚本

### 需要生成的内容
使用「生成文档」工具，创建一份包含以下内容的完整素材文档：

#### 1. 故事概念 (Story Concept)
- 一句话概括 + 3-5句展开描述
- 明确核心冲突和情感落点

#### 2. 角色小传 (Character Bible)
- 主要角色的外貌、性格、动机
- 角色之间的关系
- **字数限制：总计不超过500字**

#### 3. 角色一致性锚点 (Character Consistency Anchors) 🆕
❗❗ **重要：确保 AI 生成的多个镜头中角色保持一致** ❗❗

**核心思路：每个场景保留至少 2 个一致性锚点**

为每个主要角色定义以下锚点（至少选择 2 项）：

| 锚点类型 | 说明 | 示例 |
|---------|------|------|
| **服装锚点** | 关键服装元素保持一致 | 同一条红色围巾、同一款金色手镯、特定颜色的外套 |
| **发型锚点** | 发型发色不变 | 披肩长发、左侧分缝、马尾边的发卡、魯鬓子红色 |
| **动作锚点** | 标志性小动作 | 习惯性撩头发、托腮、叉腰、走路时背手 |
| **表情锚点** | 招牌表情 | 微微皱眉、嘴角上扬、翁起嘴角的笑容 |

输出格式：
```
### 角色一致性锚点

**[角色名]**
- 服装锚点：...
- 发型锚点：...
- 动作锚点：...
- 表情锚点：...

❗ 提示：生成每个镜头时，必须在 Prompt 中明确包含以上锚点描述，确保角色跨镜头一致性。
```

#### 4. 分镜脚本 (Storyboard Script)
❗❗ **重要：不要使用表格，改用文章段落格式** ❗❗

每个镜头用独立段落描述，格式如下：

```
---
**镜头 01｜0-3秒**

【画面描述】
（在此写出完整的画面描述，包括场景、角色动作、表情、镜头运动、光影氛围等。必须包含角色一致性锚点的关键描述，写成流畅的叙述性段落，方便直接复制作为提示词使用）

【对白/旁白】
（如有）

---
**镜头 02｜3-7秒**

【画面描述】
...

【对白/旁白】
...

---
```

每个镜头的「画面描述」应该是一段完整的文字，可以直接复制粘贴到 AI 视频工具作为提示词。**每个镜头必须包含角色一致性锚点的关键元素。**

#### 5. 剪辑节奏指南 (Editing Rhythm Guide) 🆕
❗❗ **重要：确保同一角色在整部视频中保持一致的动作节奏** ❗❗

不同角色类型有不同的推荐速度基准值：

| 角色类型 | 推荐速度 | 效果说明 |
|---------|---------|----------|
| 沉稳型 | 0.7-0.9x | 慢半拍，显得深沉、稳重 |
| 普通型 | 1.0x | 正常速度，自然流畅 |
| 活泼型 | 1.1-1.3x | 快半拍，显得灵动、年轻 |
| 暴躁型 | 1.4-1.6x | 动作利落，情绪外放 |

**核心原则：同一个角色，整部视频保持同一个速度基准值！**

输出格式：
```
### 剪辑节奏指南

| 角色 | 类型 | 推荐速度 | 说明 |
|------|------|---------|------|
| [角色名] | [类型] | [X.Xx] | [为什么选择这个速度] |

❗ 提示：在即梦/可灵等工具中生成视频后，剪辑时按此速度调整，确保角色性格一致。
```

#### 6. 视觉风格指南 (Visual Style Guide)
- 整体色调、光影风格
- 参考影片/画面
- 需要避免的视觉元素

#### 7. 音效设计建议 (Sound Design Notes)
- 背景音乐风格建议
- 关键音效点标注
- 情绪节奏曲线

### 输出要求
- 所有内容整合到一个文档中
- 使用清晰的标题层级
- 内容要具体可执行，不要泛泛而谈
- 分镜脚本的画面描述必须是段落形式，不要用表格
- **每个镜头的画面描述必须包含角色一致性锚点的关键元素**
- 可以使用搜索网络功能查找参考资料（如特定风格的视觉参考）

## Step 3：生成首尾帧参考图

### 前置条件
已在 Step 2 完成分镜脚本、角色一致性锚点和视觉风格指南。

### 任务
根据分镜脚本和视觉风格指南，使用「生成图片」工具生成首帧和尾帧的参考图。

### ❗ 第一步：先确认视频比例

在生成图片之前，**必须先询问用户想要的视频比例**：

```
📹 请选择视频比例：

1️⃣ **16:9 横版** — 适合 B站/YouTube/电脑播放
2️⃣ **9:16 竖版** — 适合 抖音/小红书/手机全屏
3️⃣ **1:1 方形** — 适合 微信朋友圈/Instagram

请告诉我你的选择～
```

**必须等用户确认比例后，才能生成图片！**

### 第二步：生成首尾帧图片

用户确认比例后，根据选择生成图片：

#### 首帧图片 (Opening Frame)
- 对应分镜脚本的第一个镜头
- 画面需要有吸引力，能抓住观众注意力
- 风格严格遵循视觉风格指南

#### 尾帧图片 (Closing Frame)
- 对应分镜脚本的最后一个镜头
- 画面需要有情感落点或悬念感
- 与首帧保持视觉风格一致性

### 图片生成要求
- **宽高比**：根据用户选择设置（16:9 / 9:16 / 1:1）
- Prompt 需要包含：
  - 视觉风格指南中的色调、光影描述
  - 分镜脚本中该镜头的具体画面描述
  - **角色一致性锚点中的关键元素（服装、发型、动作、表情）**
  - 角色小传中的角色外貌特征（如有角色出镜）
- 如果用户提供了参考图片，要把参考图片作为 source_image_urls 传入，保持风格一致

### 输出
生成两张图片后，告知用户：
```
🎬 素材包已生成完毕！

你现在拥有：
✅ 完整的分镜脚本和剧本
✅ 角色一致性锚点（确保跨镜头一致）
✅ 剪辑节奏指南
✅ 视觉风格指南
✅ 音效设计建议
✅ 首帧参考图（[16:9/9:16/1:1]）
✅ 尾帧参考图（[16:9/9:16/1:1]）

可以直接拿这些素材去即梦/可灵生成视频了！

💡 小提示：
1. 在即梦中选择「首尾帧」模式，上传这两张图，粘贴分镜描述
2. 生成后按「剪辑节奏指南」调整角色速度，确保性格一致
3. 注意保持「角色一致性锚点」中的关键元素
```

### 如果是多段视频
如果在 Step 2 中拆分成了多个15秒片段，则需要为每个片段生成首尾帧（共 2×N 张图片），并在输出时按片段编号整理。