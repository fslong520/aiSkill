# News Skills 定时推送实现指南

## 📖 概述

News Skills 支持多种定时推送方式，本文将详细介绍 5 种实现方案，从最简单到最灵活。

---

## 🎯 方案选择建议

| 你的情况 | 推荐方案 | 难度 |
|----------|----------|------|
| Windows 用户，不想写代码 | **方案一：任务计划程序** | ⭐ 简单 |
| 需要灵活控制，开发者 | **方案二：简化版调度器** | ⭐⭐ 中等 |
| Linux/Mac 服务器 | **方案三：Cron 定时任务** | ⭐⭐ 中等 |
| 想要云端自动运行 | **方案五：GitHub Actions** | ⭐⭐⭐ 较难 |

---

## 方案一：Windows 任务计划程序（推荐新手）

### 优势
- ✅ 图形化界面，操作简单
- ✅ 无需写代码
- ✅ 系统原生支持

### 配置步骤

#### 1️⃣ 创建启动脚本

在 `news/scripts/` 目录下创建 `每日早报.bat`：

```batch
@echo off
cd /d C:\Your\Path\To\news\scripts
python fetch_news.py --source hackernews,github,36kr,producthunt --limit 15 --format markdown
```

#### 2️⃣ 打开任务计划程序

按 `Win + R`，输入 `taskschd.msc`，回车

#### 3️⃣ 创建任务

1. 右侧点击 **"创建基本任务"**
2. 名称：`每日科技早报`
3. 触发器：选择 **"每天"**，时间设为 `08:00`
4. 操作：选择 **"启动程序"**，浏览到刚创建的 `.bat` 文件
5. 完成

#### 5️⃣ 测试任务

右键任务 → **"运行"**，检查 `reports/` 目录是否生成报告

---

## 方案二：简化版调度器（推荐）

### 优势
- ✅ 不需要额外依赖
- ✅ 交互式菜单，操作友好
- ✅ 支持立即测试

### 使用方法

#### Windows 用户

双击运行：`news/scripts/启动调度器.bat`

#### 命令行用户

```bash
cd .claude/skills/news/scripts
python scheduler_simple.py
```

### 菜单选项

```
请选择模式：
  1. ⏰ 定时运行模式    # 后台运行，定时执行
  2. ▶️  立即执行任务    # 选择任务立即执行
  3. ❓ 帮助
  0. 🚪 退出
```

### 立即执行任务

```
请选择要执行的任务：
  1. 科技早报 (HN, GitHub, 36Kr, Product Hunt, 腾讯)
  2. AI 专题 (HN, GitHub, Product Hunt)
  3. 全网扫描 (所有数据源)
  4. Hacker News 单独
  5. GitHub Trending 单独
```

### 定时任务配置

程序默认配置了 3 个定时任务：
- 🌅 **08:00** - 科技早报
- ☀️ **12:00** - AI 专题
- 🌙 **20:00** - 全网扫描

### 自定义时间

编辑 `scheduler_simple.py`，修改时间：

```python
# 修改为你想要的时间
if "09:00" <= current_time < "09:01":  # 改为早上 9 点
    fetch_news("🌅 科技早报", "hackernews,github,36kr,producthunt,tencent", 15)
```

---

## 方案三：Cron 定时任务（Linux/Mac）

### 配置步骤

#### 1️⃣ 编辑 crontab

```bash
crontab -e
```

#### 2️⃣ 添加定时任务

```bash
# 每天 8 点获取科技早报
0 8 * * * cd /path/to/.claude/skills/news/scripts && python fetch_news.py --source hackernews,github,36kr,producthunt --limit 15 --format markdown

# 每天 12 点获取 AI 专题
0 12 * * * cd /path/to/.claude/skills/news/scripts && python fetch_news.py --source hackernews,github,producthunt --keyword "AI" --limit 20 --format markdown

# 每天 20 点全网扫描
0 20 * * * cd /path/to/.claude/skills/news/scripts && python fetch_news.py --source all --limit 10 --format markdown
```

#### 3️⃣ 查看任务

```bash
crontab -l
```

---

## 方案四：开机自启动（Windows）

### 方法一：启动文件夹

1. 按 `Win + R`，输入 `shell:startup`
2. 将 `启动调度器.bat` 的快捷方式复制到打开的文件夹
3. 重启电脑，调度器会自动启动

### 方法二：任务计划程序高级设置

在任务计划程序中：
1. 创建任务时，选择 **"当计算机启动时"**
2. 触发器改为 **"启动时"**
3. 操作设置为运行 `scheduler_simple.py`

---

## 方案五：GitHub Actions（云端自动运行）

### 优势
- ✅ 完全云端运行
- ✅ 不需要本地电脑开机
- ✅ 自动保存报告

### 配置步骤

#### 1️⃣ 在 GitHub 仓库创建配置文件

创建 `.github/workflows/daily-news.yml`：

```yaml
name: Daily News Report

on:
  schedule:
    - cron: '0 0 * * *'  # UTC 0点 = 北京时间 8点
  workflow_dispatch:      # 支持手动触发

jobs:
  fetch-news:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.11'

    - name: Install dependencies
      run: |
        cd .claude/skills/news
        pip install requests beautifulsoup4

    - name: Fetch news
      run: |
        cd .claude/skills/news/scripts
        python fetch_news.py --source all --limit 15 --format markdown

    - name: Upload reports
      uses: actions/upload-artifact@v3
      with:
        name: news-report-${{ github.run_number }}
        path: .claude/skills/news/scripts/reports/*.md
        retention-days: 30
```

#### 2️⃣ 提交到 GitHub

```bash
git add .
git commit -m "Add daily news workflow"
git push
```

#### 3️⃣ 查看运行结果

在 GitHub 仓库页面：
1. 点击 **"Actions"** 标签
2. 查看 **"Daily News Report"** 工作流
3. 下载生成的报告

---

## 💡 进阶玩法

### 1️⃣ 发送到微信/邮件

#### 使用 Server酱（微信推送）

```python
import requests

def send_to_wechat(title, content):
    """发送到微信"""
    url = f"https://sctapi.ftqq.com/YOUR_SENDKEY.send"
    data = {
        "title": title,
        "desp": content
    }
    requests.post(url, data=data)

# 在 fetch_news 后调用
send_to_wechat("每日科技早报", markdown_content)
```

### 2️⃣ 自动保存到云盘

```python
import shutil

def save_to_cloud(report_file):
    """保存到云盘同步目录"""
    cloud_dir = Path("C:/Users/你的用户名/OneDrive/News")
    shutil.copy2(report_file, cloud_dir)
```

### 3️⃣ 生成 HTML 邮件

```python
# 生成更美观的 HTML 格式
cmd = [..., "--format", "html"]
```

---

## ⚠️ 注意事项

### 1️⃣ 电脑休眠问题

**问题**：电脑休眠后定时任务不会运行

**解决**：
- Windows：设置电源选项，选择 **"从不休眠"**
- 或使用：`powercfg /change standby-timeout-ac 0`

### 2️⃣ 网络连接

**问题**：网络断开导致获取失败

**解决**：脚本有自动重试机制，会自动处理

### 3️⃣ 报告清理

**问题**：报告文件会越来越多

**解决**：在脚本中添加自动清理逻辑

```python
from datetime import timedelta

def clean_old_reports(days=7):
    """清理超过 7 天的报告"""
    cutoff = datetime.now() - timedelta(days=days)
    for file in REPORTS_DIR.glob("*.md"):
        if datetime.fromtimestamp(file.stat().st_mtime) < cutoff:
            file.unlink()
```

---

## 🎁 总结

对于大多数用户，推荐使用：

1. **Windows 用户**：方案一（任务计划程序）或 方案二（简化版调度器）
2. **Linux/Mac 用户**：方案三（Cron）
3. **高级用户**：方案五（GitHub Actions）

选择最适合你的方案，享受每日自动推送的新闻早报吧！

---

## 📞 获取帮助

如果配置过程中遇到问题：

1. 检查 Python 路径是否正确
2. 确认依赖已安装
3. 查看日志文件
4. 在公众号后台留言

祝使用愉快！
